<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>RCM Loading Example</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- AngularJS -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->

    <script type="text/javascript"
            src="/vendor/rcm-js-lib/dist/rcm-guid.js"></script>
    <script type="text/javascript"
            src="/vendor/rcm-js-lib/dist/rcm-event-manager.js"></script>
    <script type="text/javascript"
            src="/vendor/rcm-loading/dist/rcm-loading-config.js"></script>
    <script type="text/javascript"
            src="/vendor/rcm-loading/dist/rcm-loading.js"></script>
    <script type="text/javascript"
            src="/vendor/rcm-loading/dist/rcm-loading-service.js"></script>
    <script type="text/javascript"
            src="/vendor/rcm-loading/dist/angular-rcm-loading.js"></script>
    <script type="text/javascript">

        /**
         * Direct changing of dom
         */
        var updateLoaderBar = function (selector, loadingPerc) {

            var message = loadingPerc + '%';

            if (loadingPerc >= 100) {
                message = 'Complete';
            }

            $(selector + ' .progress-bar')
                    .css('width', loadingPerc + '%')
                    .attr('aria-valuenow', loadingPerc)
                    .html(message);
        };

        var rcmLoadingExample = rcmLoadingService.rcmLoading;

        rcmLoadingService.event.on(
                'rcmLoadingService.loadingStart',
                function (loadingParams) {
                    //console.log('example.onLoadingStart', loadingParams);
                },
                'rcmLoadingExample',
                true
        );

        rcmLoadingService.event.on(
                'rcmLoadingService.loadingChange',
                function (loadingParams) {
                    updateLoaderBar('.total', loadingParams.rcmLoading.getPercent());
                    //console.log('example.onLoadingStart', loadingParams);
                },
                'rcmLoadingExample',
                true
        );

        rcmLoadingService.event.on(
                'rcmLoadingService.loadingComplete',
                function (loadingParams) {
                    updateLoaderBar('.total', loadingParams.rcmLoading.getPercent());
                    //console.log('example.onLoadingStart', loadingParams);
                },
                'rcmLoadingExample',
                true
        );

        var rcmLoadingExampleInit = function () {

            updateLoaderBar('.test1', 0);
            updateLoaderBar('.test2', 0);

            /**
             * Starting to load
             */
            rcmLoadingExample.setLoading(
                    'test1',
                    0,
                    {
                        onChange: function (params) {
                            //console.log('onChange test1', params);
                            updateLoaderBar('.test1', params.getPercent());

                        },
                        onComplete: function (params) {
                            //console.log('onComplete test1', params);
                            updateLoaderBar('.test1', params.getPercent());
                        }
                    }
            );

            /**
             * Mock loading
             */
            window.setTimeout(
                    function () {
                        rcmLoadingExample.setLoading('test1', .25);
                        rcmLoadingExample.setLoading(
                                'test2',
                                0,
                                {
                                    onChange: function (params) {
                                        //console.log('onChange test2', params);
                                        updateLoaderBar(
                                                '.test2',
                                                params.getPercent()
                                        );

                                    },
                                    onComplete: function (params) {
                                        //console.log('onComplete test2', params);
                                        updateLoaderBar(
                                                '.test2',
                                                params.getPercent()
                                        );
                                    }
                                }
                        );
                    },
                    1000
            );

            window.setTimeout(
                    function () {
                        rcmLoadingExample.setLoading('test1', .5);
                        rcmLoadingExample.setLoading('test2', .33);
                    },
                    2000
            );

            window.setTimeout(
                    function () {
                        rcmLoadingExample.setLoading('test1', 1);
                        rcmLoadingExample.setLoading('test2', .66);
                    },
                    3000
            );

            window.setTimeout(
                    function () {
                        rcmLoadingExample.setLoading('test2', 1);
                    },
                    4000
            );
        };
    </script>
</head>
<body ng-app="RcmLoading">

<rcm-global-loader></rcm-global-loader>
<!--<div rcm-global-loader></div>-->
<div>
    <div>
        <h1>Rcm Loading Example:</h1>
    </div>
    <div style="width: 50%">
        <h3>Global Progess</h3>

        <div class="total progress">
            <div class="progress-bar"
                 role="progressbar"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: 0%;">
                0%
            </div>
        </div>

        <h3>Test1 Progess</h3>

        <div class="test1 progress">
            <div class="progress-bar"
                 role="progressbar"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: 0%;">
                0%
            </div>
        </div>

        <h3>Test2 Progess</h3>

        <div class="test2 progress">
            <div class="progress-bar"
                 role="progressbar"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: 0%;">
                0%
            </div>
        </div>
        <button type="button"
                class="btn btn-primary"
                onclick="rcmLoadingExampleInit()">Test Loading
        </button>
    </div>
    <div>
        <h2>Basic Usage</h2>

        <h5>This intiates a loader and allows events to be tracked for this loading event</h5>

        <code>
            <pre>
rcmLoadingService.rcmLoading.setLoading(
        'my-loading-name',                      // Unique name for your loading bit
        0,
        {
                                                // Fires when my-loading-name changes
            onChange: function (params) {
                                                // Update something onChange
                myPercent = params.getPercent();
                myText = 'Loading';
            },
                                                // Fires when my-loading-name completes
            onComplete: function (params) {
                //update something onComplete
                myPercent = params.getPercent();
                myText = 'Complete';
            }
        }
);
            </pre>
        </code>
        <h5>Fire this to trigger 50% complete</h5>
        <code>
            <pre>
rcmLoadingService.rcmLoading.setLoading(
    'my-loading-name',                          // Unique name for your loading instance
    .5
);
            </pre>
        </code>
        <h5>Fire this to trigger loading complete</h5>
        <code>
            <pre>
rcmLoadingService.rcmLoading.setLoading(
    'my-loading-name',                          // Unique name for your loading bit
    1
);
            </pre>
        </code>
        <h5>To track global loading status, use the events</h5>
        <code>
            <pre>
rcmLoadingService.event.on(
        'rcmLoadingService.loadingStart',       // Other events: 'rcmLoadingService.loadingChange' 'rcmLoadingService.loadingComplete'
        function (loadingParams) {
                                                // Do your stuf here
        },
        'my-event-name',                        // Unique name for your loading event
        true,                                   // This will alloe the event to trigger now if the event has already triggered
);
            </pre>
        </code>
    </div>
</div>

</body>
</html>