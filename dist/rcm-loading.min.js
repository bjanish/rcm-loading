/*! rcm-loading 2015-05-14 */

var rcmLoading={defaultConfig:{},serviceInstance:null,getServiceInstance:function(config){return rcmLoading.serviceInstance?rcmLoading.serviceInstance:(rcmLoading.buildServiceInstance(config),rcmLoading.serviceInstance)},buildServiceInstance:function(config){config||(config=rcmLoading.defaultConfig),rcmLoading.serviceInstance=new rcmLoading.Service(config)},isLoading:function(name){var service=rcmLoading.getServiceInstance();return service.tracker.isLoading(name)},setLoading:function(name,amount,options){var service=rcmLoading.getServiceInstance();service.setLoading(name,amount,options)},onLoadingStart:function(method,id){var service=rcmLoading.getServiceInstance();service.events.on("rcmLoadingService.loadingStart",method,id,!0)},onLoadingChange:function(method,id){var service=rcmLoading.getServiceInstance();service.events.on("rcmLoadingService.loadingChange",method,id,!0)},onLoadingComplete:function(method,id){var service=rcmLoading.getServiceInstance();service.events.on("rcmLoadingService.loadingComplete",method,id,!0)}};rcmLoading.defaultConfig={baseUrl:"/vendor/rcm-loading/dist",templateFolder:"/template",template:"default",loadingMessage:"Loading..",loadingCompleteMessage:"Complete"},rcmLoading.Params=function(options){var self=this;self.name=null,self.amount=0,self.options=null,self.onChange=function(params){},self.onComplete=function(params){},self.init=function(options){self.setOptions(options)},self.setOptions=function(options){"string"==typeof options.name&&(self.name=options.name),"number"==typeof options.amount&&(self.amount=options.amount),"function"==typeof options.onChange&&(self.onChange=options.onChange),"function"==typeof options.onComplete&&(self.onComplete=options.onComplete),"string"==typeof options.message&&(self.message=options.string),self.options=options},self.getPercent=function(){return Math.round(100*self.amount)},self.isLoading=function(){return self.amount<1},self.init(options)},rcmLoading.Tracker=function(onLoadingStart,onLoadingChange,onLoadingComplete){var self=this;self.loadingAggregate={},self.loadingAmount=1,self.getPercent=function(){return Math.round(100*self.loadingAmount)},self.isLoading=function(name){return name?self.getLoading(name)<1&&self.has(name):self.loadingAmount<1},self.setLoading=function(name,amount,options){self.has(name)?self.loadingAggregate[name].amount=amount:self.add(name,amount,options),self.calc()},self.getLoading=function(name){return self.has(name)?self.loadingAggregate[name].amount:null},self.has=function(name){return"object"==typeof self.loadingAggregate[name]},self.add=function(name,amount,options){options||(options={}),options.name=name,options.amount=amount;var params=new rcmLoading.Params(options);self.loadingAggregate[name]=params},self.remove=function(name){self.loadingAggregate[name]=void 0;try{delete self.loadingAggregate[name]}catch(exception){}},self.calc=function(){self.loadingAmount>=1&&self.onLoadingStart();var currentLoadingAmount=self.loadingAmount,currentLoading={},completeLoading={},total=0,count=0;for(var index in self.loadingAggregate)self.has(index)&&(count++,total+=self.loadingAggregate[index].amount,currentLoading[index]=self.loadingAggregate[index],self.loadingAggregate[index].onChange(self.loadingAggregate[index]),self.loadingAggregate[index].amount>=1&&(completeLoading[index]=self.loadingAggregate[index],self.loadingAggregate[index].onComplete(self.loadingAggregate[index])));count>0?self.loadingAmount=total/count:self.loadingAmount=1,currentLoadingAmount!==self.loadingAmount&&self.onLoadingChange(currentLoading,completeLoading),self.loadingAmount>=1&&self.onLoadingComplete(completeLoading)},self.onLoadingStart=function(){"function"==typeof onLoadingStart&&onLoadingStart({tracker:self})},self.onLoadingChange=function(currentLoading,completeLoading){"function"==typeof onLoadingChange&&onLoadingChange({tracker:self,currentLoading:currentLoading,completeLoading:completeLoading})},self.onLoadingComplete=function(completeLoading){"function"==typeof onLoadingComplete&&onLoadingComplete({tracker:self,completeLoading:completeLoading}),self.loadingAggregate={}}},rcmLoading.Service=function(config){var self=this;self.config={},self.tracker=null,self.events=new RcmEventManager,self.eventNames={start:"rcmLoadingService.loadingStart",change:"rcmLoadingService.loadingChange",complete:"rcmLoadingService.loadingComplete"};var onLoadingStart=function(loadingParams){self.events.trigger(self.eventNames.start,loadingParams)},onLoadingChange=function(loadingParams){self.events.trigger(self.eventNames.change,loadingParams)},onLoadingComplete=function(loadingParams){self.events.trigger(self.eventNames.complete,loadingParams)};self.init=function(config){self.config=config,self.tracker=new rcmLoading.Tracker(onLoadingStart,onLoadingChange,onLoadingComplete)},self.setLoading=function(name,amount,options){self.tracker.setLoading(name,amount,options)},self.getTracker=function(){return self.tracker},self.getConfigValue=function(key,defaultValue){return"undefined"!=typeof self.config[key]?self.config[key]:defaultValue},self.getTemplateUrl=function(file){file||(file="");var baseUrl=self.getConfigValue("baseUrl","."),template=self.getConfigValue("template","default"),templateFolder=self.getConfigValue("templateFolder","/template");return baseUrl+templateFolder+"/"+template+"/"+file},self.init(config)};
//# sourceMappingURL=rcm-loading.map